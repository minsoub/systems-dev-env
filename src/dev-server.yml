version: '3.7'
services:
  redis:
     image: redis:alpine
     command: redis-server --port 6379
     container_name: redisdb
     hostname: redisdb
     labels:
       - "name=redis"
       - "mode=standalone"
     ports:
       - 6379:6379
  db:
     image: mariadb:10
     container_name: mysqldb
     ports:
        - 3306:3306
     volumes:
        - ./mysql/conf.d:/etc/mysql/conf.d
        - ./mysql/data:/var/lib/mysql
        - ./mysql/initdb.d:/docker-entrypoint-initdb.d
     env_file: ./mysql/.env
     environment:
        TZ: Asia/Seoul
     restart: always
  zookeeper:
     image: wurstmeister/zookeeper:3.4.6
     container_name: zookeeper
     ports:
        - 2181:2181
  kafka:
     image: wurstmeister/kafka:2.12-2.3.0
     container_name: kafka
     depends_on:
        - zookeeper
     ports:
        - 9092:9092
     environment:
        KAFKA_ADVERTISED_HOST_NAME: 127.0.0.1
        KAFKA_ADVERTISED_PORT: 9092
        KAFKA_CREATE_TOPICS: "systems_topic:2:2"
        KAFKA_ZOOKEEPER_CONNECT: zookeeper:2181
     volumes:
        - ./kafka/docker.sock:/var/run/docker.sock

